# Progpedia

## Что это за программа
Приложение OMIS помогает инженерам мониторинга контроллировать заявки подрядчика: хранит их в базе данных, отслеживает изменения статусов по письмам из Outlook и вовремя напоминает в Telegram, если подрядчик задерживается. Веб-интерфейс на Flask позволяет быстро добавлять новые заявки и просматривать актуальное состояние, а планировщик автоматически запускает проверку почты и уведомления.

## Как работает `database.py`
Модуль отвечает за работу с SQLite. Он создаёт файл базы данных (путь берётся из `config.py` или переменной окружения) и включает четыре основные функции:
- `init_db()` — создаёт таблицу заявок и индекс по времени обновления, если их ещё нет.
- `add_request()` — добавляет новую заявку с базовым статусом «заявка отправлена».
- `update_status()` — обновляет статус существующей заявки и фиксирует время изменения.
- `get_requests()` — возвращает список заявок, отсортированный по времени последнего обновления.

Внутри используется менеджер контекста `_connect()`, который открывает соединение с SQLite, включает фабрику строк `Row`, выполняет коммит операций и откатывает транзакцию при ошибке. Все действия логируются через `logging`, поэтому их легко отслеживать в журналах.

## Для чего нужна переменная `__all__`
Переменная `__all__` определяет, какие имена экспортирует модуль при импорте вида `from project.database import *`. Сейчас туда входят `DEFAULT_STATUS`, `add_request`, `get_requests`, `init_db`, `update_status`, то есть только публичные функции и константа. Если нужно предоставить наружу новую функцию, добавь её название в список. Если хочешь скрыть служебную часть, убери ёё из `__all__` и убедись, что внешний код не полагался на импорт этого имени.
